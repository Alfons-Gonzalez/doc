CONFIGURACIÓN NODOS CÁLCULO GENCLUSTER
======================================


1.- Particiones discos (HP ProLiant DL165 G7):

/dev/sda1	50 GB	/
/dev/sda2	128 GB	swap
/dev/sda3	288 GB	/scratch

2.- Sistema Operativo: Fedora 12 x86_64 (instalación stándard). 

- Misma instalación que en las workstation de trabajo (instalar
paquetes del fichero pkglst.txt y añadir sepositorio de rpmfusion)

- Han de arrancar en init 3

- Paramos el servicio de selinux

3.- Red.

- Han de coger la ip por DHCP. Añadir el nodo junto con su Mac Addres
en el fichero de configuración del servicio de DHCP en el nodo master.

4.- Añadir la clave pública del usuario root del nodo master para poder
conectarnos por ssh sin contraseña.

5.- Configuracion del nodo:

- /etc/hosts 

127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.1.1     gencluster

- /etc/sysconfig/iptables

# Firewall configuration written by system-config-firewall
# Manual customization of this file is not recommended.
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -s 192.168.1.0/24 -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
COMMIT

- /etc/fstab (hemos de crear los directorios en el nodo !!)

gencluster:/usr/local   /usr/local                              nfs     defaults        0 0
gencluster:/paquets/F12 /soft                                   nfs     defaults        0 0
gencluster:/db          /db                                     nfs     defaults        0 0
gencluster:/data/users  /data/users                             nfs     defaults        0 0
beta:/genomics/users    /genomics/users                         nfs     defaults        0 0
sanger:/data            /projects                               nfs     defaults        0 0
rabat:/data /projects_bg nfs defaults 0 0

- Configurar servicio ypfind

[root@node1 ~]# cat /etc/yp.conf 
# generated by /sbin/dhclient-script
domain genomica server 192.168.1.1

[root@node1 ~]# cat /etc/sysconfig/network
HOSTNAME=localhost.localdomain
NETWORKING=yes
NISDOMAIN=genomica

- /etc/ld.so.conf

[root@node1 ~]# cat /etc/ld.so.conf
include ld.so.conf.d/*.conf
/soft/lib
/soft/lib64

- Una vez configurados todos estos servicios hay que reiniciarlos:

service iptables restart
mount -t nfs -av
service ypbind start; chkconfig ypbind on
ldconfig -v

- Activamos el servicio ntp (como el fichero de configuración se copia de
/usr/local/src, hemos de esperar a tener montado por nfs el directorio
/usr/local):

# cp /usr/local/src/ntp.conf /etc/ntp.conf
# chkconfig ntpd on
# service ntpd start

6.- En el nodo master:

- Si se trata de un nodo nuevo,  añadir el nodo al /etc/hosts del nodo 
master y reiniciar el servirio de NIS.

- Si se trata de un nodo nuevo, añadir el nodo en el /etc/exports. Reiniciar servidio
de nfs.

7.- Instalar en el nodo paquetes adicionales que estén en el directorio /usr/local/rpms

8.- Añadir el nodo a las colas:

- En el nodo master:
	[root@gencluster ~]# source /usr/local/sge/default/common/settings.sh
	[root@gencluster ~]# qconf -ah nodeX

- En el nodo:		
	[root@node14 ~]# source /usr/local/sge/default/common/settings.sh
	[root@node14 ~]# cd $SGE_ROOT
	[root@node14 sge]# ./install_execd

	(intro acceptant tots els defaults)

	- Desde gencluster, verifiquem que el node está up y que el veïem a la cua 'all.q'.
	[root@gencluster ~]# qstat -f | grep <node-name> 

- Por último, usando la herramienta qmon ya podemos añadir el nodo a la cola donde tenga que
estar.
